---
- name: Set the hostname of this system
  become: True
  hostname:
    name: "{{ base_hostname }}"

- name: Update packages and install base packages
  become: True
  apt:
    pkg: "{{ item }}"
    state: present
    update_cache: yes
  with_items: "{{ base_packages + base_extra_packages }}"

- name: "Create the user '{{ base_user.name }}'"
  become: True
  user:
    name: "{{ base_user.name }}"
    createhome: yes
    home: "{{ base_home_dir }}"
    # set the default shell for the user
    shell: "{{ base_user.shell }}"
    state: present

- name: Create the additional groups if nonexistent
  become: True
  group:
    name: "{{ item }}"
    system: yes
    state: present
  with_items:
    - "{{ base_user_extra_groups }}"

- name: "Add user '{{ base_user.name }}' to necessary groups"
  become: True
  user:
    name: "{{ base_user.name }}"
    groups: "{{ base_user_extra_groups }}"
    append: yes

- name: "Set default editor to '{{ base_editor }}'"
  become: True
  shell: "update-alternatives --set editor {{ base_editor }}"
  register: change_editor
  changed_when: change_editor.stdout != ""

- name: Configure system
  include_tasks: config.yml
  tags:
    - config
